================================================================================================================================
Domain privilege escalation from a standard user by exploiting CVE-2021-42278 and CVE-2021-42287 (sAMAccountName impersonation)
================================================================================================================================

Vulnerabilities
----------------
CVE-2021-42278 - Name impersonation
CVE-2021-42287 - KDC bamboozling

URLs
-----
> https://exploit.ph/more-samaccountname-impersonation.html
> https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html
> https://www.thehacker.recipes/ad/movement/kerberos/samaccountname-spoofing

Attack methodology and steps
-----------------------------
Step 1. Clear the controlled machine account servicePrincipalName attribute of any value that points to its name 
        (e.g. host/machine.domain.local, RestrictedKrbHost/machine.domain.local) 
Step 2. Change the controlled machine account sAMAccountName to a Domain Controller's name without the trailing (CVE-2021-42278)
Step 3. Request a TGT for the controlled machine account
Step 4. Reset the controlled machine account sAMAccountName to its old value (or anything else different than the Domain Controller's name without the trailing $)
Step 5. Request a service ticket with S4U2self by presenting the TGT obtained before (CVE-2021-42287)
Step 6. Get access to the domain controller (i.e. DCsync)


